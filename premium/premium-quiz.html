<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Premium - PedaClic</title>

    <!-- Lien vers le design system (si disponible, sinon on utilise les styles int√©gr√©s) -->
    <!-- <link rel="stylesheet" href="assets/css/design-system.css"> -->
    
    <style>
        /* ==============================================
           VARIABLES CSS - Palette de couleurs PedaClic
           ============================================== */
        :root {
            --primary-color: #4F46E5;      /* Indigo principal */
            --success-color: #10B981;       /* Vert succ√®s */
            --danger-color: #EF4444;        /* Rouge erreur */
            --warning-color: #F59E0B;       /* Orange alerte */
            --neutral-50: #F9FAFB;          /* Fond tr√®s clair */
            --neutral-100: #F3F4F6;         /* Fond clair */
            --neutral-200: #E5E7EB;         /* Bordures */
            --neutral-600: #4B5563;         /* Texte secondaire */
            --neutral-700: #374151;         /* Texte */
            --neutral-800: #1F2937;         /* Texte fonc√© */
            --neutral-900: #111827;         /* Texte principal */
        }

        /* ==============================================
           RESET & BASE STYLES
           ============================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body { 
            background: var(--neutral-50); 
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--neutral-900);
        }

        /* ==============================================
           CONTENEUR PRINCIPAL DU QUIZ
           ============================================== */
        .quiz-wrapper { 
            max-width: 800px; 
            margin: 40px auto; 
            padding: 20px; 
        }

        /* ==============================================
           EN-T√äTE DU QUIZ
           ============================================== */
        .quiz-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .quiz-header h1 {
            font-size: 2.5rem;
            color: var(--neutral-900);
            margin-bottom: 10px;
        }

        .quiz-header p {
            color: var(--neutral-600);
            font-size: 1.1rem;
        }

        /* ==============================================
           AFFICHAGE DU RECORD PERSONNEL
           ============================================== */
        .high-score-display {
            text-align: center;
            margin-bottom: 20px;
            padding: 12px;
            background: var(--neutral-100);
            border-radius: 12px;
            font-size: 0.95rem;
            color: var(--neutral-700);
        }

        .high-score-display strong {
            color: var(--primary-color);
            font-weight: 700;
        }

        /* ==============================================
           S√âLECTEURS DE NIVEAU ET MATI√àRE
           ============================================== */
        .quiz-nav {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        select {
            padding: 14px 16px;
            border-radius: 12px;
            border: 2px solid var(--neutral-200);
            font-size: 1rem;
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
            background: white;
            font-weight: 500;
            color: var(--neutral-900);
        }

        select:hover {
            border-color: var(--primary-color);
            background: var(--neutral-50);
        }

        select:focus { 
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        /* ==============================================
           TIMER (COMPTE √Ä REBOURS)
           ============================================== */
        .timer-container {
            text-align: right;
            margin-bottom: 15px;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary-color);
            transition: color 0.3s ease;
        }

        .timer-container.warning {
            color: var(--danger-color);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* ==============================================
           CARTE PRINCIPALE DU QUIZ
           ============================================== */
        .quiz-card {
            background: white;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 
                        0 10px 10px -5px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
            min-height: 400px;
        }

        /* ==============================================
           BARRE DE PROGRESSION
           ============================================== */
        .progress-bar {
            position: absolute;
            top: 0; 
            left: 0; 
            height: 6px;
            background: var(--primary-color);
            transition: width 0.5s ease-in-out;
            z-index: 10;
        }

        /* ==============================================
           QUESTION
           ============================================== */
        .question-text {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: 25px;
            line-height: 1.5;
        }

        /* ==============================================
           LISTE DES OPTIONS DE R√âPONSE
           ============================================== */
        .options-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-item {
            padding: 18px 24px;
            border: 2px solid var(--neutral-200);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            background: white;
            display: flex;
            align-items: center;
            position: relative;
        }

        .option-item:hover {
            border-color: var(--primary-color);
            background: #EEF2FF;
            transform: translateX(4px);
        }

        /* √âtat correct */
        .option-item.correct {
            background: #D1FAE5;
            border-color: var(--success-color);
            color: #065F46;
            pointer-events: none;
        }

        .option-item.correct::after {
            content: '‚úì';
            position: absolute;
            right: 20px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* √âtat incorrect */
        .option-item.wrong {
            background: #FEE2E2;
            border-color: var(--danger-color);
            color: #991B1B;
            pointer-events: none;
        }

        .option-item.wrong::after {
            content: '‚úó';
            position: absolute;
            right: 20px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* ==============================================
           BOUTONS
           ============================================== */
        .btn-next {
            margin-top: 30px;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            display: none;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-next:hover {
            background: #4338CA;
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3);
        }

        .btn-next:active {
            transform: translateY(0);
        }

        /* ==============================================
           AFFICHAGE DES R√âSULTATS
           ============================================== */
        .score-display {
            text-align: center;
            display: none;
            padding: 20px 0;
        }

        .score-display h2 {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-weight: 800;
        }

        .score-display p {
            font-size: 1.2rem;
            color: var(--neutral-700);
            margin-bottom: 15px;
            line-height: 1.8;
        }

        .score-display .btn-next {
            display: inline-block;
            width: auto;
            min-width: 200px;
        }

        /* ==============================================
           MESSAGE D'ATTENTE (Quiz en pr√©paration)
           ============================================== */
        .loading-message {
            text-align: center;
            padding: 60px 40px;
            color: var(--neutral-600);
        }

        .loading-message .emoji {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .loading-message h3 {
            color: var(--neutral-900);
            margin-bottom: 15px;
            font-size: 1.8rem;
        }

        .loading-message p {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        /* ==============================================
           MODAL DU CERTIFICAT
           ============================================== */
        .certificate-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .certificate-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            border: 5px solid #FFD700;
            position: relative;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .certificate-content .emoji {
            font-size: 5rem;
            margin-bottom: 15px;
        }

        .certificate-content h2 {
            color: #d4af37;
            margin: 15px 0;
            font-size: 2rem;
        }

        .certificate-content p {
            margin: 15px 0;
            font-size: 1.1rem;
        }

        .certificate-subject {
            text-transform: uppercase;
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.5rem;
            margin: 20px 0;
        }

        .certificate-score {
            font-weight: bold;
            font-size: 2rem;
            color: var(--success-color);
        }

        .certificate-footer {
            font-style: italic;
            font-size: 0.9rem;
            color: #666;
            margin-top: 20px;
        }

        .btn-close-cert {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-close-cert:hover {
            background: #4338CA;
            transform: translateY(-2px);
        }

        /* ==============================================
           RESPONSIVE DESIGN
           ============================================== */
        @media (max-width: 768px) {
            .quiz-wrapper {
                padding: 15px;
                margin: 20px auto;
            }

            .quiz-header h1 {
                font-size: 2rem;
            }

            .quiz-nav {
                grid-template-columns: 1fr;
            }

            .quiz-card {
                padding: 25px;
            }

            .question-text {
                font-size: 1.2rem;
            }

            .option-item {
                padding: 14px 18px;
            }

            .score-display h2 {
                font-size: 3rem;
            }

            .certificate-content {
                padding: 30px 20px;
                margin: 20px;
            }
        }
    </style>
</head>
<body>  

    <!-- =====================================================
         CONTENEUR PRINCIPAL DU QUIZ
         ===================================================== -->
    <div class="quiz-wrapper">
        
        <!-- En-t√™te avec titre et description -->
        <div class="quiz-header">
            <h1>Espace Quiz Premium üá∏üá≥</h1>
            <p>Validez vos acquis avec nos experts</p>
        </div>

        <!-- Affichage du record personnel -->
        <div class="high-score-display" id="high-score-display">
            üèÜ <strong>Record personnel :</strong> <span id="best-score">0</span>/12 
            (<span id="best-subject">-</span>)
        </div>

        <!-- S√©lecteurs de discipline et niveau -->
        <div class="quiz-nav">
            <select id="discipline">
                <option value="fr">Fran√ßais</option>
                <option value="maths">Math√©matiques</option>
                <option value="svt">SVT</option>
                <option value="pc">Physique-Chimie</option>
                <option value="philo">Philosophie</option>
            </select>
            <select id="level">
                <option value="facile">Niveau : Facile</option>
                <option value="moyen">Niveau : Moyen</option>
                <option value="defi">Niveau : D√©fi</option>
            </select>
        </div>

        <!-- Timer (compte √† rebours) -->
        <div class="timer-container" id="timer-container">
            ‚è±Ô∏è Temps restant : <span id="time-left">30</span>s
        </div>

        <!-- Carte principale contenant le quiz -->
        <div class="quiz-card" id="quiz-card">
            
            <!-- Barre de progression -->
            <div class="progress-bar" id="progress"></div>
            
            <!-- Zone d'affichage des questions -->
            <div id="quiz-content"></div>
            
            <!-- Bouton "Question suivante" -->
            <button id="next-btn" class="btn-next" onclick="nextQuestion()">
                Question Suivante ‚Üí
            </button>
            
            <!-- Zone d'affichage des r√©sultats finaux -->
            <div id="result-area" class="score-display">
                <h2 id="final-score">0/12</h2>
                <p id="feedback-text"></p>
                <button class="btn-next" onclick="location.reload()">
                    üîÑ Recommencer
                </button>
            </div>
        </div>
    </div>

    <!-- =====================================================
         MODAL DU CERTIFICAT (affich√© pour 12/12)
         ===================================================== -->
    <div id="certificate-modal" class="certificate-modal">
        <div class="certificate-content">
            <div class="emoji">üéì</div>
            <h2>CERTIFICAT DE R√âUSSITE</h2>
            <p>F√©licitations ! Tu as d√©montr√© une excellente ma√Ætrise en :</p>
            <div class="certificate-subject" id="certif-subject">Discipline</div>
            <p>Score parfait : <span class="certificate-score">12 / 12</span></p>
            <p class="certificate-footer">D√©livr√© par PedaClic Premium</p>
            <button class="btn-close-cert" onclick="closeCertif()">Fermer</button>
        </div>
    </div>

    <!-- =====================================================
         FICHIERS AUDIO POUR LES FEEDBACKS
         ===================================================== -->
    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>

    <!-- =====================================================
         SCRIPT JAVASCRIPT - LOGIQUE DU QUIZ
         ===================================================== -->
    <script>
        /* =================================================
           VARIABLES GLOBALES
           ================================================= */
        let database = {};              // Base de donn√©es des questions
        let currentQ = 0;               // Index de la question actuelle
        let score = 0;                  // Score de l'utilisateur
        let activeQuestions = [];       // Questions du quiz en cours
        let timeLeft;                   // Temps restant (en secondes)
        let timerInterval;              // Intervalle du timer
        const TIME_LIMIT = 30;          // Limite de temps par question (30 secondes)

        /* =================================================
           CHARGEMENT DE LA BASE DE DONN√âES DES QUESTIONS
           Charge le fichier questions.json au d√©marrage
           ================================================= */
        async function loadDatabase() {
            try {
                const response = await fetch('questions.json');
                if (!response.ok) throw new Error("Erreur de chargement du JSON");
                
                database = await response.json();
                console.log("‚úÖ Base de donn√©es charg√©e avec succ√®s");
                startQuiz(); // Lance le quiz une fois les donn√©es charg√©es
            } catch (error) {
                console.error("‚ùå Erreur:", error);
                document.getElementById('quiz-content').innerHTML = `
                    <div class="loading-message">
                        <div class="emoji">‚ö†Ô∏è</div>
                        <h3>Erreur de chargement</h3>
                        <p>Impossible de charger les questions.</p>
                        <p style="font-size: 0.9rem; color: var(--neutral-600);">
                            Assurez-vous que le fichier <code>questions.json</code> est pr√©sent.
                        </p>
                    </div>
                `;
            }
        }

        /* =================================================
           D√âMARRAGE DU QUIZ
           R√©cup√®re la discipline et le niveau choisis,
           puis charge les questions correspondantes
           ================================================= */
        function startQuiz() {
            // R√©cup√©ration des choix de l'utilisateur
            const disc = document.getElementById('discipline').value;
            const lvl = document.getElementById('level').value;
            
            // V√©rification : la cat√©gorie existe-t-elle ?
            if (database[disc] && database[disc][lvl] && database[disc][lvl].length > 0) {
                // Initialisation du quiz
                activeQuestions = database[disc][lvl];
                currentQ = 0;
                score = 0;
                
                // Mise √† jour de l'affichage
                document.getElementById('result-area').style.display = 'none';
                document.getElementById('quiz-content').style.display = 'block';
                document.getElementById('timer-container').style.display = 'block';
                
                showQuestion();
            } else {
                // Message si le module n'est pas encore disponible
                document.getElementById('quiz-content').innerHTML = `
                    <div class="loading-message">
                        <div class="emoji">üöß</div>
                        <h3>Quiz en cours de pr√©paration</h3>
                        <p>Le module <strong>${disc.toUpperCase()} (${lvl})</strong> arrive bient√¥t sur PedaClic Premium.</p>
                        <p style="font-size: 0.9rem;">En attendant, essayez le niveau <strong>D√©fi</strong> en Fran√ßais !</p>
                    </div>
                `;
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('progress').style.width = "0%";
                document.getElementById('timer-container').style.display = 'none';
            }
        }

        /* =================================================
           AFFICHAGE D'UNE QUESTION
           G√©n√®re le HTML de la question et lance le timer
           ================================================= */
        function showQuestion() {
            const q = activeQuestions[currentQ];
            
            // Mise √† jour de la barre de progression
            const progress = ((currentQ) / activeQuestions.length) * 100;
            document.getElementById('progress').style.width = progress + "%";
            
            // G√©n√©ration du HTML de la question
            let html = `<div class="question-text">${currentQ + 1}. ${q.q}</div>
                        <div class="options-list">`;
            
            q.o.forEach((opt, i) => {
                html += `<div class="option-item" onclick="checkAnswer(this, ${i})">${opt}</div>`;
            });
            
            html += `</div>`;
            document.getElementById('quiz-content').innerHTML = html;
            document.getElementById('next-btn').style.display = 'none';
            
            // D√©marrage du compte √† rebours
            startTimer();
        }

        /* =================================================
           D√âMARRAGE DU TIMER
           Lance un compte √† rebours de 30 secondes
           ================================================= */
        function startTimer() {
            timeLeft = TIME_LIMIT;
            document.getElementById('time-left').innerText = timeLeft;
            
            // Reset du style du timer
            const timerContainer = document.getElementById('timer-container');
            timerContainer.classList.remove('warning');
            
            // Effacement de l'ancien intervalle s'il existe
            clearInterval(timerInterval);
            
            // D√©marrage du nouveau compte √† rebours
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('time-left').innerText = timeLeft;
                
                // Changement de couleur quand il reste 5 secondes
                if (timeLeft <= 5) {
                    timerContainer.classList.add('warning');
                }
                
                // Temps √©coul√© : passage automatique √† la question suivante
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleTimeOut();
                }
            }, 1000);
        }

        /* =================================================
           GESTION DU TIMEOUT
           Appel√©e quand le temps est √©coul√© sans r√©ponse
           ================================================= */
        function handleTimeOut() {
            const items = document.querySelectorAll('.option-item');
            const correctIndex = activeQuestions[currentQ].c;
            
            // D√©sactivation des clics
            items.forEach(item => item.style.pointerEvents = 'none');
            
            // Affichage de la bonne r√©ponse
            items[correctIndex].classList.add('correct');
            
            // Son d'erreur
            document.getElementById('sound-wrong').play();
            
            // Affichage du bouton "Question suivante"
            document.getElementById('next-btn').style.display = 'block';
        }

        /* =================================================
           V√âRIFICATION DE LA R√âPONSE
           Appel√©e quand l'utilisateur clique sur une option
           ================================================= */
        function checkAnswer(el, selected) {
            // Arr√™t du timer
            clearInterval(timerInterval);
            
            const correctIndex = activeQuestions[currentQ].c;
            const items = document.querySelectorAll('.option-item');
            
            // D√©sactivation des clics
            items.forEach(item => item.style.pointerEvents = 'none');

            // V√©rification de la r√©ponse
            if (selected === correctIndex) {
                // R√©ponse correcte
                el.classList.add('correct');
                score++;
                document.getElementById('sound-correct').play();
            } else {
                // R√©ponse incorrecte
                el.classList.add('wrong');
                items[correctIndex].classList.add('correct');
                document.getElementById('sound-wrong').play();
            }
            
            // Affichage du bouton "Question suivante"
            document.getElementById('next-btn').style.display = 'block';
        }

        /* =================================================
           PASSAGE √Ä LA QUESTION SUIVANTE
           ================================================= */
        function nextQuestion() {
            currentQ++;
            if (currentQ < activeQuestions.length) {
                showQuestion();
            } else {
                showResult();
            }
        }

        /* =================================================
           AFFICHAGE DES R√âSULTATS FINAUX
           ================================================= */
        function showResult() {
            // Arr√™t du timer et masquage
            clearInterval(timerInterval);
            document.getElementById('timer-container').style.display = 'none';
            
            // Masquage du contenu du quiz
            document.getElementById('quiz-content').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('progress').style.width = "100%";
            
            // Affichage de la zone de r√©sultats
            const res = document.getElementById('result-area');
            res.style.display = 'block';
            document.getElementById('final-score').innerText = `${score} / ${activeQuestions.length}`;
            
            // G√©n√©ration du message de feedback
            let msg = "";
            if (score === activeQuestions.length) {
                msg = "üéâ F√©licitations ! Un vrai g√©nie PedaClic !";
            } else if (score >= activeQuestions.length / 2) {
                msg = "üëè Bien jou√© ! Continuez ainsi.";
            } else {
                msg = "üìö Besoin de r√©vision ? Relisez vos cours Premium.";
            }

            // Gestion du syst√®me de records
            const disc = document.getElementById('discipline').value;
            const lvl = document.getElementById('level').value;
            const recordKey = `record_${disc}_${lvl}`;
            const oldRecord = parseInt(localStorage.getItem(recordKey) || 0);

            if (score > oldRecord) {
                localStorage.setItem(recordKey, score);
                msg += `<br><strong style="color:var(--success-color)">üåü Nouveau Record Personnel !</strong>`;
            } else if (oldRecord > 0) {
                msg += `<br><span style="color:var(--neutral-600)">Votre record actuel sur ce module : ${oldRecord}/${activeQuestions.length}</span>`;
            }
            
            document.getElementById('feedback-text').innerHTML = msg;

            // Mise √† jour du meilleur score global
            updateBestScore(score, disc);

            // D√©clenchement du certificat si score parfait
            if (score === activeQuestions.length) {
                setTimeout(() => {
                    showCertificate(disc);
                }, 800);
            }
        }

        /* =================================================
           MISE √Ä JOUR DU MEILLEUR SCORE GLOBAL
           ================================================= */
        function updateBestScore(finalScore, subject) {
            const savedScore = parseInt(localStorage.getItem('pedaclic_best_score') || 0);
            
            if (finalScore >= savedScore) {
                localStorage.setItem('pedaclic_best_score', finalScore);
                localStorage.setItem('pedaclic_best_subject', subject);
                displayBestScore();
            }
        }

        /* =================================================
           AFFICHAGE DU MEILLEUR SCORE
           ================================================= */
        function displayBestScore() {
            const score = localStorage.getItem('pedaclic_best_score');
            const subject = localStorage.getItem('pedaclic_best_subject');
            
            if (score !== null && score > 0) {
                document.getElementById('best-score').innerText = score;
                
                // Conversion du code de mati√®re en nom complet
                const subjectNames = {
                    'fr': 'Fran√ßais',
                    'maths': 'Math√©matiques',
                    'svt': 'SVT',
                    'pc': 'Physique-Chimie',
                    'philo': 'Philosophie'
                };
                document.getElementById('best-subject').innerText = subjectNames[subject] || subject;
            }
        }

        /* =================================================
           AFFICHAGE DU CERTIFICAT
           ================================================= */
        function showCertificate(subject) {
            const subjectNames = {
                'fr': 'Fran√ßais',
                'maths': 'Math√©matiques',
                'svt': 'SVT',
                'pc': 'Physique-Chimie',
                'philo': 'Philosophie'
            };
            
            document.getElementById('certif-subject').innerText = subjectNames[subject] || subject;
            document.getElementById('certificate-modal').style.display = 'flex';
        }

        /* =================================================
           FERMETURE DU CERTIFICAT
           ================================================= */
        function closeCertif() {
            document.getElementById('certificate-modal').style.display = 'none';
        }

        /* =================================================
           √âCOUTEURS D'√âV√âNEMENTS
           ================================================= */
        document.getElementById('discipline').addEventListener('change', startQuiz);
        document.getElementById('level').addEventListener('change', startQuiz);

        /* =================================================
           INITIALISATION AU CHARGEMENT DE LA PAGE
           ================================================= */
        window.onload = () => {
            loadDatabase();     // Chargement de la base de questions
            displayBestScore(); // Affichage du record personnel
        };
    </script>

</body>
</html>
